# 离线扩容云盘（Windows系统）

云盘（系统盘或数据盘）使用空间不足时，您可以扩容云盘的存储容量。如果您的ECS实例不支持在线扩容云盘，可以通过离线扩容的方式为Windows实例进行扩容云盘。离线扩容云盘需要重启实例，您的业务会短暂中断，建议在业务不繁忙时操作。

在Windows实例使用离线扩容云盘前，需要满足以下条件。

|资源|限制条件|
|--|----|
|实例|-   实例状态为**运行中**（Running）或**已停止**（Stopped）。
-   如果实例是Windows Server 2003操作系统，则仅支持扩容数据盘，不支持扩容系统盘。 |
|云盘|-   云盘状态为**使用中**（In Use）。
-   云盘类型为ESSD云盘、SSD云盘或高效云盘。
-   云盘为NTFS文件系统。
-   包年包月ECS实例续费降配后，当前计费周期的剩余时间内，不支持扩容实例的包年包月云盘。
-   云盘扩容后的容量不能超过云盘最高容量，具体请参见[块存储使用限制](/cn.zh-CN/产品简介/使用限制.md)。

**说明：**

一个已有分区采用了MBR分区格式，则不支持扩容到2 TiB及以上。如果您的MBR分区容量需要扩容到2 TiB以上，请选择以下方式：

-   （建议）您先创建一块大于2 TiB的云盘并格式化为GPT分区，再将MBR分区中的数据拷贝到GPT分区中。格式化GPT分区操作，请参见[分区格式化大于2 TiB数据盘](/cn.zh-CN/块存储/云盘基础操作/分区格式化数据盘/分区格式化大于2 TiB数据盘.md)。
-   您直接在实例中将MBR分区转换为GPT分区。转换分区格式有数据丢失的风险，请谨慎操作，具体请参见[更换Windows数据盘分区格式](/cn.zh-CN/块存储/云盘基础操作/分区格式化数据盘/分区格式化大于2 TiB数据盘.md)。 |

## 步骤一：创建快照

在扩容云盘前，为云盘创建快照，做好数据备份。

1.  登录[ECS管理控制台](https://ecs.console.aliyun.com)。

2.  在左侧导航栏，单击**实例与镜像** \> **实例**。

3.  在顶部菜单栏左上角处，选择地域。

4.  找到需要扩容云盘的实例，单击实例ID。

5.  在**实例详情**页，单击**云盘**页签。

6.  找到需要扩容的云盘，在**操作**列单击**创建快照**。

7.  在弹出的对话框中，输入快照名称，并按需绑定标签后，单击**确定**。

8.  单击**快照**页签，查看已创建的快照。

    当快照的**进度**为**100%**时，表示快照创建完成，您可以执行后续操作。


## 步骤二：在控制台扩容云盘容量并重启（或启动）ECS实例

1.  在**实例详情**页，单击**云盘**页签。

2.  选择需要扩容的云盘，在**操作**列单击**更多** \> **云盘扩容**。

    如果需要批量扩容多个云盘，请使用阿里云主账号在**存储与快照** \> **云盘**页面选择多个云盘后，单击底部的**云盘扩容**。挂载在同一ECS实例下的云盘不支持批量扩容功能。

3.  在**磁盘扩容**页面，设置**扩容后容量**。

    设置的**扩容后容量**不允许小于当前容量。

4.  确认费用，阅读并选择服务条款后，单击**确定扩容**。

5.  阅读磁盘扩容须知后，单击**已阅读，继续扩容**，完成支付。

6.  在控制台重启（或启动）实例。

    **说明：**

    -   如果您的实例状态为**运行中**（Running）则需要在控制台重启实例；如果您的实例状态为**已停止**（Stopped）则需要在控制台启动实例。
    -   实例必须经过控制台重启实例或者调用API RebootInstance，才可以看到云盘容量扩展。在实例操作系统里重启无效。
    以下步骤以重启实例为示例。

    1.  在左侧导航栏，单击**实例与镜像** \> **实例**。

    2.  找到需要重启的实例，在**操作**列单击**更多** \> **实例状态** \> **重启**。

    3.  在**重启实例**对话框中，单击**确定**。


## 步骤三：扩容系统盘或数据盘分区的文件系统

在ECS控制台上扩容云盘后，对应分区的文件系统并未扩容。您需要连接实例扩容文件系统。扩容前的容量为40 GiB，扩容为60 GiB，文件系统类型为NTFS。此步骤以扩容系统盘分区的文件系统为例。

1.  远程登录ECS实例，具体操作请参见[通过Workbench远程连接Windows实例](/cn.zh-CN/实例/连接实例/连接Windows实例/通过Workbench远程连接Windows实例.md)。

2.  在Windows Server桌面，右键单击**开始**图标，然后单击**磁盘管理**。

    ![磁盘管理](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/4563359951/p140800.png)

3.  在**磁盘管理**对话框中，单击**操作** \> **重新扫描磁盘** ，查看未分配的磁盘容量。

    ![caozuo1](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/4563359951/p86770.png)

    其中，磁盘0是系统盘，磁盘1是数据盘。

4.  右键单击**磁盘 0**主分区的空白处，并选择**扩展卷**。

    **说明：** 如果扩容数据盘，则右键单击对应数据盘（例如**磁盘 1**）主分区进行扩容。

    ![kuozhan](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/4563359951/p86807.png)

5.  根据**扩展卷向导**的默认设置完成扩展卷操作。

    扩容完成后，新增空间会自动合入原来的卷中，如下图所示。

    ![kuozhan2](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/4563359951/p86808.png)

    扩容完成后，您需要根据实际情况检查数据是否正常。

    -   如果扩容成功，ECS实例中的业务程序能够正常运行，则完成操作。
    -   如果扩容失败，则通过备份的快照回滚数据。

## （可选）步骤四：在数据盘上创建新分区

云盘新扩容的容量如果需要用于创建新分区，请参见此步骤操作。

1.  远程登录ECS实例，具体操作请参见[通过Workbench远程连接Windows实例](/cn.zh-CN/实例/连接实例/连接Windows实例/通过Workbench远程连接Windows实例.md)。

2.  在Windows Server桌面，右键单击**开始**图标，然后单击**磁盘管理**。

3.  在**磁盘管理**对话框中，单击**操作** \> **重新扫描磁盘** ，查看未分配的磁盘容量。

    ![caozuo1](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/4563359951/p86770.png)

    其中，磁盘0是系统盘，磁盘1是数据盘。

4.  右键单击**磁盘1**未分配区的空白处，并选择**新建简单卷**。

    ![jiandan1](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/4563359951/p86817.png)

5.  根据新建简单卷向导的默认设置完成简单卷操作。

    完成后，新增的数据盘空间会新建一个分区。


**相关文档**  


[扩容云盘常见问题]()

[RebootInstance](/cn.zh-CN/API参考/实例/RebootInstance.md)

[ResizeDisk](/cn.zh-CN/API参考/块存储/ResizeDisk.md)

[AttachDisk](/cn.zh-CN/API参考/块存储/AttachDisk.md)

