# 经典网络和专有网络互通最佳实践

经典网络和专有网络互通可以通过建立ClassicLink连接实现网络互通，也可以将经典网络迁移至专有网络后，通过云企业网实现专有网络的互通。本教程介绍如何将多台经典网络类型的ECS实例迁移至专有网络，并和新创建的专有网络类型的ECS实例实现互通。

确保经典网络类型的ECS实例符合以下条件：

-   不能是挂载了本地盘的实例规格族。
-   ECS实例不在华东1（杭州）地域的可用区C内，该可用区的部分ECS实例不支持迁移网络类型。
-   您业务需求的应用服务均已设置为开机自启动。
-   检查业务需求的软件，是否采用绑定网卡MAC地址注册合法环境。由于迁移专有网络VPC后公网网卡会被移除，因此网卡MAC地址会丢失。此时，您可以联系软件供应商确认所使用的软件是否通过绑定网卡MAC地址注册了您的ECS实例，如果是则需要重新绑定到ECS实例主网卡。

在正式操作前，请确保您已了解以下注意事项及使用限制：

-   ECS实例从经典网络迁移至专有网络的注意事项，请参见[ECS实例从经典网络迁移到专有网络](/cn.zh-CN/网络/经典网络迁移到专有网络（新版）/ECS实例从经典网络迁移到专有网络.md)中背景信息章节。
-   云企业网的使用限制，请参见[使用限制]()。

本教程中使用如下资源作为示例：

![Resources](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/9184677161/p167235.png)

-   两台经典网络类型的ECS实例：`ECS-1`和`ECS-2`
-   一台专有网络类型的ECS实例：`ECS-3`
-   实例迁移计划中新创建的VPC：`VPC-1`
-   一台专有网络类型的ECS实例对应的VPC：`VPC-2`

通过以下步骤实现网络互通：

1.  通过实例迁移计划，将ECS实例从经典网络迁移至专有网络。
2.  通过绑定云企业网的方式实现`VPC-1`与`VPC-2`网络互通。

本教程中的示例场景为同账号同地域，因此不需要配置云企业网的互通带宽等功能。如果您的互通需求需要跨账号跨地域，也可以通过云企业网实现。详情请参见[云企业网]()。

如果您的云资源均在同一个账号的同一个地域下，并且业务需求较少，不需要将经典网络迁移至专有网络，您可以使用ClassicLink功能实现经典网络和专有网络互通，详情请参见[经典网络和专有网络互通](/cn.zh-CN/网络/经典网络和专有网络互通.md)。

## 步骤一：经典网络迁移到专有网络

通过实例迁移计划将ECS实例（ECS-1和ECS-2）从经典网络迁移到专有网络（VPC-1）。您可以直接在实例迁移计划中自动创建VPC，即**选择迁移的目标专有网络**设置为**（默认）系统自动创建专有网络，网段：10.0.0.0/8**。

具体操作，请参见[ECS实例从经典网络迁移到专有网络](/cn.zh-CN/网络/经典网络迁移到专有网络（新版）/ECS实例从经典网络迁移到专有网络.md)。

## 步骤二：创建并绑定云企业网

等待经典网络类型的ECS实例迁移网络完成后，需要完成以下操作实现`VPC-1`和`VPC-2`的网络互通。

1.  登录[云企业网控制台](https://cen.console.aliyun.com)。

2.  单击**创建云企业网实例**。

3.  在**加载网络实例**区域，完成以下配置项。

    -   **实例类型**：选择**专有网络（VPC）**
    -   **地域**：选择`VPC-1`所在的地域。例如：**华东2（上海）**
    -   **网络实例**：选择步骤一中创建的`VPC-1`
4.  完成其它基础配置项后，单击**确定**。

    详情请参见[创建CEN实例]()。

5.  登录[专有网络管理控制台](https://vpcnext.console.aliyun.com/vpc)。

6.  在顶部菜单栏处，选择ECS实例`ECS-3`的专有网络`VPC-2`所在的地域。

7.  找到`VPC-2`，并单击名称进入**专有网络详情**页面。

8.  单击**加入云企业网**，并选择已创建好的云企业网。


## 步骤三：验证互通性

通过以上步骤，即可实现`ECS-1`、`ECS-2`、`ECS-3`三台ECS实例的网络互通。由于`ECS-1`和`ECS-2`迁移至了同一个VPC下，所以两台ECS实例是内网互通的。您只需要远程连接使用`VPC-2`的ECS实例`ECS-3`，并运行以下命令，检查与其它两台ECS实例是否互通即可。

```
ping <ECS实例的私网IP>
```

例如，运行命令`ping 10.0.**.**`。正确的返回结果如下图所示。

![ping](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1783420061/p166976.png)

