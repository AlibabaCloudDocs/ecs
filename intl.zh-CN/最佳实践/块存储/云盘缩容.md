# 云盘缩容

由于目前云服务器ECS不支持系统盘或者数据盘缩容，如果您有云盘缩容的需求，可以通过阿里云服务器迁移中心SMC达成目的。

请确保您已完成迁移前的准备工作，更多信息，请参见[准备工作（迁移前必读）](/intl.zh-CN/用户指南/准备工作（迁移前必读）.md)。

SMC的研发初衷是为了平衡阿里云用户的云上及线下业务负载，但是您也可以利用其工作原理，实现云服务器ECS的云盘缩容。

SMC可以根据您的ECS实例重新创建一份自定义镜像或者直接迁移至目标实例，在导入迁移源时，通过重新指定云盘大小进行缩容。开始迁移前，您必须注意：

-   如果您使用迁移源迁移至目标实例的方式完成云盘缩容，请确保迁移源与目标实例不是同一台实例。您必须迁移至除迁移源的其它可用ECS实例，并且该目标实例内无数据或已将所有数据备份至镜像、快照或该实例以外的设备中。

    **警告：** 创建迁移任务后，目标实例中的原数据将会清除。因此，如果作为目标实例的ECS实例中存在重要数据，SMC不推荐您使用该方式将迁移源直接迁移至目标实例。推荐您在迁移时，目标类型选择云服务器镜像，再通过镜像创建ECS实例。

-   由于使用SMC进行云盘缩容将更换ECS实例，因此会引起ECS实例的部分属性发生变化。例如：实例ID（`InstanceId`）和公网IP。

    如果您的迁移源实例为专有网络VPC类型的实例，可以将公网IP转换为弹性公网IP以保留该公网IP。因此，如果您已使用弹性公网IP（EIP）或者对公网IP依赖程度较轻，建议您使用SMC完成云盘缩容。


1.  导入迁移源。

    您需要先在待缩容的ECS实例内下载SMC客户端，并通过SMC客户端将该实例作为迁移源导入SMC。具体操作，请参见[步骤一：导入迁移源](/intl.zh-CN/用户指南/步骤一：导入迁移源.md)。

2.  创建并启动迁移任务。

    迁移至指定目标实例完成云盘缩容的具体操作，请参见[源服务器迁移至目标实例](/intl.zh-CN/最佳实践/源服务器迁移至目标实例.md)。创建迁移任务时您需要注意：

    -   **目标磁盘**中的**系统盘**和**数据盘**大小，设置为您需要缩容的预期值，该值不能小于系统盘或数据盘实际使用空间的大小。
    -   如果您需要通过迁移源创建自定义镜像，再通过自定义镜像创建新的ECS实例，请在创建迁移任务时，将**目标类型**设置为**云服务器镜像**。
3.  等待迁移任务完成。

    -   当迁移任务状态为**已完成**（Finished），表示任务完成并能够查看目标实例。
        -   如果您选择迁移的目标类型为云服务器实例，可以在操作列，单击**查看目标实例**跳转至目标实例详情页。
        -   如果您选择迁移的目标类型为云服务器镜像，可以按照以下操作使用镜像创建一个新的ECS实例。
            1.  验证迁移结果。该功能将使用阿里云提供的OOS模板ACS-SMC-CreateAndVerifyInstance，自动验证迁移任务生成的镜像能否成功创建实例，并正常启动。
                1.  在操作列单击**验证迁移结果**。
                2.  在弹出的对话框中了解验证流程，并单击**立即验证**。

                    您也可以单击**自定义验证脚本参数**，手动配置参数进行验证。

                3.  在**最近一次迁移结果验证状态**列，查看验证结果。
                    -   **成功**：表示迁移结果无异常。您可以单击**查看输出参数**了解验证结果。
                    -   **失败**：表示迁移结果存在异常。您可以单击**查看原因**了解失败的原因，并根据原因排查问题。
                    -   您也可以单击操作列![...](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/3079670061/p169257.png)，并单击**前往OOS查看历史验证**获取OOS模板的历史执行信息。
            2.  在操作列单击**创建实例**。

                ![list](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/3079670061/p129881.png)

            3.  配置实例信息并完成实例创建，具体操作，请参见[使用自定义镜像创建实例](/intl.zh-CN/实例/创建实例/使用自定义镜像创建实例.md)。
            4.  远程连接实例，检查迁移后的系统，具体操作，请参见[迁移Windows服务器后怎么检查系统](/intl.zh-CN/常见问题/SMC FAQ.md)或[迁移Linux服务器后怎么检查系统](/intl.zh-CN/常见问题/SMC FAQ.mdsection_8nx_71l_ksv)。
    -   当任务状态为**出错**（InError），表示任务失败。您需要查看日志修复问题后，再次重启迁移任务。常见错误及修复方案，请参见[SMC FAQ](/intl.zh-CN/常见问题/SMC FAQ.md)。

