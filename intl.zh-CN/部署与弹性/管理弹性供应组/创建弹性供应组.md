# 创建弹性供应组

本文介绍如何在控制台创建弹性供应组，弹性供应组会按照您的设置自动交付实例集群。

-   已授予账号操作弹性供应组相关云资源的权限。

    **说明：** 首次进入弹性供应功能页面时，按提示授权系统RAM角色`AliyunECSAutoProvisioningGroupRole`即可。

-   已创建实例启动模板。具体操作，请参见[创建实例启动模板](/intl.zh-CN/部署与弹性/管理实例启动模板/创建实例启动模板.md)。

    弹性供应组使用实例启动模板的指定版本作为配置来源，沿用配置来源中的镜像、安全组、登录凭证等属性。


1.  进入弹性供应功能页面。

    1.  登录[ECS管理控制台](https://ecs.console.aliyun.com)。

    2.  在顶部菜单栏左上角处，选择地域。

    3.  在左侧导航栏，选择**部署与弹性** \> **弹性供应**。

2.  单击**创建供应组**。

3.  在**供应组名称**区域，输入弹性供应组的名称。

    名称长度为2~128个字符，必须以大小写字母或中文开头，不能以http://和https://开头。可以包含数字、下划线（\_）、连字符（-）和句点（.）。

4.  在**目标容量**区域，设置容量相关选项。

    容量相关选项决定弹性供应组交付的算力总和，以及抢占式实例和按量实例的算力占比，选项如下表所示。

    |容量相关选项|说明|
    |------|--|
    |**目标容量**|计划使用弹性供应组交付的算力，单位支持**实例个数**和**vCPU个数**。选中**使用按量实例提供部分算力**后，可以继续指定使用按量实例提供的算力。**说明：** 默认全部交付抢占式实例，设置按量实例容量大于0时才会交付按量实例。 |
    |**按量实例容量**|目标容量中需要使用按量付费方式购买的实例个数或vCPU个数。由于抢占式实例存在回收机制，您可以通过指定使用按量实例提供的算力保证满足最低算力需求。|

    弹性供应组通过实例规格权重表示单台实例在弹性供应组中提供的容量大小。

    -   如果目标容量单位为**实例个数**，各实例规格的权重都是相同的。
    -   如果目标容量单位为**vCPU个数**，各实例规格的权重和vCPU个数有关，vCPU个数越多权重越大，满足目标容量所需实例的数量越少。假设目标容量为24 vCPU，使用不同规格分别交付8 vCPU的示例如下表所示。

        |实例规格|vCPU|权重|满足目标容量所需实例的数量|
        |----|----|--|-------------|
        |ecs.c6.large|2|2|4|
        |ecs.c6.xlarge|4|4|2|
        |ecs.c6.2xlarge|8|8|1|

        **说明：** 在控制台创建弹性供应组时，您无需为每个实例规格手动设置权重，弹性供应会根据vCPU个数自动赋予实例规格权重。

5.  在**配置来源**和**实例配置**区域，设置实例属性相关选项。

    弹性供应组支持多可用区、多实例规格。如果单可用区下或单实例规格的库存不足导致实例创建失败，弹性供应组会自动尝试在其他可用区或使用其他实例规格创建实例，有效提高创建成功率。

    您可以通过指定多个属于不同可用区的交换机实现多可用区，通过增加扩展实例规格实现多实例规格。示例如下图所示，更多示例，请参见[弹性供应组设置示例](/intl.zh-CN/部署与弹性/管理弹性供应组/弹性供应组设置示例.md)。

    ![multi-zone-type](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/4006564161/p244716.png)

    该示例中包括了2个可用区、3个实例规格，上图中各序号对应的操作说明如下表所示。

    |序号|操作说明|
    |--|----|
    |①|选择一个实例启动模板的指定版本作为配置来源。**说明：** 创建实例时使用②、④中指定的交换机和实例规格，但沿用该配置来源中的镜像、安全组、登录凭证等属性。 |
    |②|完成实例配置，默认使用配置来源中指定的交换机和实例规格。您也可以自行选择其他交换机，选择和增加其他实例规格。**说明：** 弹性供应组至少需要一条实例配置。 |
    |③|增加1条实例配置，以实现多个可用区。|
    |④|完成增加的实例配置，其中至少设置以下信息：    -   **指定交换机**：选择实例所属的交换机，请确保该交换机和②中交换机所属的可用区不同。

**说明：** 如果选择了同一个可用区下的多个交换机，仅第一个交换机生效。

    -   **增加实例规格**：您可以选择多个实例规格提升实例创建成功率，本示例中选择了两个实例规格。选择实例规格时，页面中推荐了相同实例大小和相同实例配比的实例规格，帮助您筛选合适的实例规格，您也可以自行选择其他实例规格。 |

    除设置交换机和实例规格外，您还可以为每个实例规格设置抢占式实例的价格上限，支持通过以下形式设置价格上限：

    -   自动出价：自动按抢占式实例的实时市场价出价，保证不会因出价低于抢占式实例市场价导致实例创建失败，且抢占式实例市场价较低时成本也随之降低。
    -   最高价（固定价格）：设置固定的价格，抢占式实例市场价高于固定价格时实例创建失败，保证不超过预算。
    -   最高价（同期按量价格）：设置相对按量实例价格的比例，保证相对按量实例可以节省一定比例的成本。例如设置为同期按量价格的50%，则抢占式实例市场价高于50%的按量实例价格时实例创建失败。
    **说明：** 推荐在设置前参考抢占式实例市场价的趋势，避免因上限过低创建不了足量的实例，或因上限过高超过预算。单击**操作**列下的**历史价格**即可查看历史价格。

6.  在**供应策略**区域，设置创建实例时的策略。

    可选项如下表所示。

    |可选项|说明|
    |---|--|
    |**容量优化策略**|综合考虑抢占式实例的历史价格波动和回收率，自动选择综合成本最优的实例规格创建实例。 **说明：** 抢占式实例可能因价格、库存等因素被回收，优先考虑回收率低的实例规格。 |
    |**成本最优策略**|按vCPU单价从低到高尝试创建实例。|
    |**多可用区均衡策略**|在实例配置中指定了不同可用区下的交换机时才有效果，在多个可用区之间均匀创建实例。回收抢占式实例时会按实例规格来逐一回收。同一实例规格族内的实例资源共享，例如无法创建ecs.c6.large时，可能原因是c6规格族都即将库存不足，ecs.c6.xlarge等规格也可能无法创建。

**说明：** 如果选用多可用区均衡策略，建议您配置不同的实例规格族，避免所有实例同时被回收，保证实例集群的高可用性。 |

7.  设置高级选项。

    选项如下表所示。

    |高级选项|说明|
    |----|--|
    |**供应组类型**|    -   **一次性交付**：弹性供应组启动后尝试交付指定容量的实例集群。只尝试一次，即使交付失败了也不会重试。
    -   **持续保持**：弹性供应组启动后尝试交付指定容量的实例集群，并且会持续比较实时容量和目标容量，如果两者存在差距则自动创建实例或缩容。 |
    |**启动时间**|指定弹性供应组开始交付指定目标容量的时间，与结束时间结合使用，确定弹性供应组的有效时段。     -   **立即启动**：创建成功后立即开始交付实例集群。
    -   **指定启动时间**：自定义弹性供应组的启动时间。 |
    |**结束时间**|与启动时间结合使用，确定弹性供应组的有效时段。     -   **无限期**：除非您主动删除弹性供应组，弹性供应组始终存在。
    -   **指定结束时间**：自定义弹性供应组的过期时间。 |
    |**全局抢占式实例的价格上限**|弹性供应组内抢占式实例的全局价格上限，适用于所有实例规格。如果该全局价格上限和实例配置中单实例规格的价格上限不一致，以较低者为准。    -   **自动出价**：自动按抢占式实例的实时市场价出价，保证不会因出价低于抢占式实例市场价导致实例创建失败，且抢占式实例市场价较低时成本也随之降低。
    -   **设置价格**：设置固定的价格，抢占式实例市场价高于固定价格时实例创建失败，保证不超过预算。 |
    |**组内实例关停设置**|    -   **供应组过期时关停供应组内实例**：弹性供应组超过结束时间后，影响组内实例的状态，选中该选项则释放组内实例，未选中该选项则只将组内实例移出弹性供应组。
    -   **超过容量时关停供应组内实例**：弹性供应组实时容量超过目标容量并触发缩容后，影响缩容的实例的状态，选中该选项则释放缩容的实例，未选中该选项则只将缩容的实例移出弹性供应组。 |

8.  单击**创建供应组**。


弹性供应组创建成功后，会在您指定的时间启动并尝试交付实例集群。如果弹性供应组的类型为**持续保持**，弹性供应组还会持续维护实例集群，在抢占式实例被回收时自动尝试创建新的实例，缩小实时容量和目标容量的差距，并及时替换不健康的实例。

**相关文档**  


[CreateAutoProvisioningGroup](/intl.zh-CN/API参考/弹性供应组/CreateAutoProvisioningGroup.md)

