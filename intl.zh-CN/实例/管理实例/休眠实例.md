# 休眠实例

如果您在某个时间段内无需运行ECS实例，也不会执行某些操作（如升降配等），建议您休眠ECS实例。相比停止实例，休眠实例后再次启动实例，ECS实例会自动恢复至休眠前的应用程序状态，便于您快速进入休眠前ECS实例的运行状态。

休眠实例时，操作系统会将内存中的数据（操作系统内正在运行的各种应用程序及使用状态）保留至实例的系统盘。当您下次启动实例时，操作系统会读取上次保留的内存数据，自动恢复至休眠前ECS实例的应用程序状态，快速进入休眠前ECS实例的运行状态。而停止实例后再次启动实例时，操作系统会重新启动后台服务和应用程序。

**说明：** 休眠失败时，会自动正常关机，即内存数据不会保存至系统盘。等实例关机后启动实例，操作系统会重新启动后台服务和应用程序，无法恢复休眠前ECS实例的应用程序状态。

在休眠时，不同购买方式的ECS实例计费有如下差异：

-   包年包月实例：休眠后不影响实例的到期时间，计费不受影响。
-   按量付费实例：取决于休眠时是否选择了**休眠不收费**选项，具体的区别如下表所示。

|资源项|休眠不收费|休眠后仍旧保留实例并继续收费|
|---|-----|--------------|
|计算资源（vCPU和内存）|释放，不收费|保留并继续收费|
|云盘（系统盘和数据盘）|保留并继续收费|保留并继续收费|
|内网IP|保留，不收费|保留，不收费|
|公网IP|释放，启动ECS实例后会获取新的公网IP，不收费|保留，不收费|
|EIP|保留并继续收费|保留并继续收费|
|带宽|继续收费|继续收费|

## 使用限制

-   休眠功能目前仅对美国（硅谷）、德国（法兰克福）地域开放，其他地域逐步开放中。
-   当ECS实例满足以下条件时，您才能在需要时使实例进入休眠状态：
    -   实例在创建时开启了休眠功能。

        **说明：** 开启休眠功能后不支持关闭该功能。创建时未开启该功能的实例无法设置该功能。

    -   实例安装了休眠Agent。
-   创建ECS实例时，您只能使用加密的自定义镜像才能开启休眠功能。并且镜像版本支持以下几种：
    -   Windows Server 2016及以上
    -   Ubuntu 18及以上
    -   CentOS 7及以上
-   如果ECS实例在创建时开启了休眠功能，则ECS实例不支持以下功能：
    -   不支持创建自定义镜像。
    -   不支持创建快照。
    -   不支持变更实例规格。
    -   不支持变更操作系统或系统盘。
    -   不支持变更包年包月ECS实例的带宽。
-   如果抢占式实例开启了休眠功能，在休眠时仅支持休眠不收费功能。
-   弹性伸缩组内的ECS实例不支持休眠功能。

## 步骤一：开启休眠功能

您必须在创建ECS实例时，选择开启休眠功能，否则无法使实例进入休眠状态。创建时，必须使用加密镜像。

1.  获取加密的自定义镜像。

    有两种方式获取：

    -   您已准备了满足休眠要求的加密自定义镜像。
    -   通过复制镜像获取，在复制过程中将镜像加密。具体步骤，请参见[复制镜像](/intl.zh-CN/镜像/自定义镜像/复制镜像.md)。
    **说明：** 镜像的限制，请参见[使用限制](#section_55c_coc_sg1)。

2.  创建ECS实例，并在创建实例时开启休眠功能。

    具体操作步骤，请参见[使用向导创建实例](/intl.zh-CN/实例/创建实例/使用向导创建实例.md)。请注意以下配置信息：

    |配置项|配置说明|举例|
    |---|----|--|
    |实例|    -   实例规格：除裸金属服务器外的任一I/O优化实例。
    -   实例内存大小：
        -   Windows：必须小于16 GiB。
        -   Linux：必须小于150 GiB。
|ecs.g6e.large|
    |镜像|    -   选择第一步创建完成的加密自定义镜像，或者已有的满足休眠要求的加密自定义镜像。
    -   选中**开启实例休眠状态**，开启休眠功能。
|    -   encrypted.windows2016
    -   选中**开启实例休眠状态** |
    |云盘|    -   系统盘：必选项，且需要满足以下要求：
        -   类型：高效云盘、SSD云盘或者ESSD云盘。
        -   容量：必须足够大，建议至少是内存的2倍。因为，在开启休眠能力时，系统盘会预留部分空间来存放内存数据。因此，系统盘的容量需要确保在存放内存数据时，还能使操作系统和内部应用程序正常运行。
        -   加密：使用加密镜像后，系统盘会默认加密。
    -   数据盘：可选项。如果在此时创建云盘作为数据盘，必须选择云盘类型、容量、数量，并设置是否加密。
|    -   系统盘：ESSD云盘，60 GiB，加密且密钥为**Default Service CMK**。
    -   数据盘：ESSD云盘，40 GiB，未加密。 |
    |网络|请选择专有网络。**说明：** 经典网络下的ECS实例不支持休眠功能。

|\[默认\]vpc-bp1opxu1zkhn00g\*\*\*\*|


## 步骤二：安装休眠Agent

在ECS实例开启休眠功能后，您必须为该实例安装休眠Agent。安装完成后，您才能使该实例进入休眠状态。

1.  创建并执行如下命令，为单台ECS实例安装休眠Agent。具体方式，请参见[立即执行命令](/intl.zh-CN/运维与监控/云助手/使用云助手/立即执行命令.md)。

    -   Windows实例：

        ```
        acs-plugin-manager.exe --exec --plugin ecs-hibernate-win --params "install"
        ```

    -   Linux实例：

        ```
        acs-plugin-manager --exec --plugin ecs-hibernate-linux --params "install"
        ```

2.  重启ECS实例，令休眠Agent生效。具体操作，请参见[重启实例](/intl.zh-CN/实例/管理实例/重启实例.md)。


## 步骤三：使实例进入休眠状态

当ECS实例已开启了休眠功能，并安装了休眠Agent，您可以使运行中的该实例进入休眠状态。在实例休眠期间，您无法连接该实例。

1.  登录[ECS管理控制台](https://ecs.console.aliyun.com)。

2.  在左侧导航栏，选择**实例与镜像** \> **实例**。

3.  在顶部菜单栏左上角处，选择地域。

4.  找到需要休眠的实例，在**操作**列，单击**更多** \> **实例状态** \> **停止**。

5.  在停止实例对话框中，完成休眠相关设置。

    1.  选择**停止方式**为**休眠**。
    2.  选择**停止模式**，您可以根据ECS实例的计费方式选择**休眠后仍旧保留实例并继续收费**或者**休眠不收费** :

        -   包年包月的ECS实例休眠后会继续收费，请选择**休眠后仍旧保留实例并继续收费**。
        -   按量付费ECS实例支持**休眠后仍旧保留实例并继续收费**或者**休眠不收费**，您可以自由选择。

            **说明：** 抢占式ECS实例只支持休眠不收费，请选择**休眠不收费**。

        **休眠后仍旧保留实例并继续收费**或者**休眠不收费**的区别，请参见[表 1](#table_82t_3jc_tg6)。

    3.  单击**确定**。

        **说明：** 实例停止，进入**已停止**状态。如需启动实例，具体操作，请参见[启动实例](/intl.zh-CN/实例/管理实例/启动实例.md)。


## 相关文档

您也可以利用OOS定时休眠和启动ECS实例，自动化管理大批量实例的休眠和启动时间，配合休眠不收费功能节省成本。具体内容，请参见[定时开关机]()。

